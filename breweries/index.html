{% extends "_base.html" %}

{% block content %}
<div class="container">
	<div class="jumbotron">
		<div id="map" style="width:100%; height:600px;"></div>
		<h1>Lane County breweries</h1>
		{% for data in breweries %}
			{% if data.point_1 %}
				{% if data.area != previous_area %}<h2>{{ data.area }}</h2>{% endif %}
				{% set previous_area = data.area %}
				<h3 id="{{ data.id }}">{{ data.name }}</h3>
				<h4>{{ data.operator_address }}</h4>
				<ul>
					<li>{{ data.point_1 }}</li>
					<li>{{ data.point_2 }}</li>
					<li>{{ data.point_3 }}</li>
					<li>{{ data.point_4|urlize }}</li>
					{% if data.point_5 %}<li>{{ data.point_5|urlize }}</li>{% endif %}
					{% if data.point_6 %}<li>{{ data.point_6 }}</li>{% endif %}
					{% if data.point_7 %}<li>{{ data.point_7 }}</li>{% endif %}
					{% if data.point_8 %}<li>{{ data.point_8 }}</li>{% endif %}
					{% if data.point_9 %}<li>{{ data.point_9 }}</li>{% endif %}
					{% if data.point_10 %}<li>{{ data.point_10 }}</li>{% endif %}
					{% if data.point_11 %}<li>{{ data.point_11 }}</li>{% endif %}
					{% if data.point_12 %}<li>{{ data.point_12 }}</li>{% endif %}
				</ul>
			{% endif %}
		{% endfor %}
	</div>
</div>
<script type="text/javascript">
	var map = L.map('map').setView([43.94529715, -122.85129255], 10);
	var mapquestLayer = new L.TileLayer('http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png', {
		maxZoom: 18,
		attribution: 'Data, imagery and map information provided by <a href="http://open.mapquest.co.uk" target="_blank">MapQuest</a>,<a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> and contributors.',
		subdomains: ['otile1','otile2','otile3','otile4']
	});
	map.addLayer(mapquestLayer);
	var data = {
		"type": "FeatureCollection",
		"features": [
		{% for data in breweries %}
			{% if data.lat %}
			{
				"type": "Feature",
				"properties": {
					"full_name": "{{ data.name }}",
					"id": "{{ data.id }}"
				},
				"geometry": {
					"type": "Point",
					"coordinates": [{{ data.lng }}, {{ data.lat }}]
				}
			}{% if not loop.last %},{% endif %}
			{% endif %}
		{% endfor %}
		]
	};
	var markers = L.markerClusterGroup();
	var dataLayer = L.geoJson(data, {
		onEachFeature: function(feature, layer){
			layer.bindPopup(
				'<a href="#' + feature.properties.id + '">' +
					feature.properties.full_name +
				'</a>'
			);
		}
	});
	markers.addLayer(dataLayer);
	map.addLayer(markers);
	map.fitBounds(markers.getBounds());
</script>
{% endblock content %}
